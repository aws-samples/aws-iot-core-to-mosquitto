{"version":3,"sources":["../../src/controller/mosquitto.js"],"names":["publish","topic","payload","Promise","resolve","reject","mosquittoClient","mosquittoURI","cleanTopic","replace","logger","info","publishMessage","asyncDevice","error","Error"],"mappings":";;;;;;;AAGA;;AACA;;AACA;;;;AALA;AACA;AAMA;AACO,eAAeA,OAAf,CAAuBC,KAAvB,EAA8BC,OAA9B,EAAuC;AAC5C;AACA,SAAO,IAAIC,OAAJ,CAAY,OAAOC,OAAP,EAAgBC,MAAhB,KAA2B;AAC5C,QAAI;AACF,YAAMC,eAAe,GAAG,MAAM,8BAAcC,iBAAd,CAA9B;AACA,YAAMC,UAAU,GAAGP,KAAK,CAACQ,OAAN,CAAc,QAAd,EAAwB,EAAxB,CAAnB;;AACAC,6BAAOC,IAAP,CAAa,6BAA4BH,UAAW,EAApD,EAHE,CAIF;;;AACA,YAAMI,cAAc,GAAG,MAAMN,eAAe,CAACO,WAAhB,CAA4Bb,OAA5B,CAC3BQ,UAD2B,EAE3BN,OAF2B,CAA7B,CALE,CASF;;AACAQ,6BAAOC,IAAP,CAAY,iCAAZ;;AACAP,MAAAA,OAAO,CAACQ,cAAD,CAAP;AACD,KAZD,CAYE,OAAOE,KAAP,EAAc;AACdT,MAAAA,MAAM,CACJ,IAAIU,KAAJ,CAAW,iDAAgDD,KAAM,EAAjE,CADI,CAAN;AAGD;AACF,GAlBM,CAAP;AAmBD","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n//  SPDX-License-Identifier: MIT-0\n\nimport { mosquittoURI } from \"../env\";\nimport { getMQTTClient } from \"../services/mosquitto\";\nimport logger from \"../utils/winstonLogger\";\n\n// eslint-disable-next-line import/prefer-default-export\nexport async function publish(topic, payload) {\n  // eslint-disable-next-line no-async-promise-executor\n  return new Promise(async (resolve, reject) => {\n    try {\n      const mosquittoClient = await getMQTTClient(mosquittoURI);\n      const cleanTopic = topic.replace(/['\"]+/g, \"\");\n      logger.info(`Sending message on topic: ${cleanTopic}`);\n      // await mosquittoClient.asyncDevice.subscribe(cleanTopic);\n      const publishMessage = await mosquittoClient.asyncDevice.publish(\n        cleanTopic,\n        payload\n      );\n      // await mosquittoClient.asyncDevice.unsubscribe(cleanTopic);\n      logger.info(\"Message Sent to Mosquitto Topic\");\n      resolve(publishMessage);\n    } catch (error) {\n      reject(\n        new Error(`Not able to publish data to Mosquitto. Error: ${error}`)\n      );\n    }\n  });\n}\n"],"file":"mosquitto.js"}